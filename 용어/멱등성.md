# [ 멱등성, idempotence ]

- 동일한 연산을 n번 수행해도 그 결과가 달라지지 않는 성질
- 네트워크 지연, 중복 요청 등 이슈를 대처할 수 있어서 분산 시스템, 마이크로 서비스 아키텍처에서 중요성이 큼 
- 시스템의 안정성과 신뢰성을 보장
  

### 멱등성 확보 방법
- API 설계
- DB Transaction 관리
- Transaction 아이디와 같은 unique 식별자 사용하여 1) 동일한 요청 구분 2) 요청 순서 관리 3) 중복 처리 방지 4) 데이터의 일관성 유지
- 상태 기계 (State Machine) 사용하여 1) 요청의 상태를 관리해 요청 처리 상태를 추적 2) 중복 요청에 대한 처리 최적화
- 데이터베이스의 고유성 제약 조건, 잠금 메커니즘, 타임아웃 설정


## REST API에서의 멱등성

- 멱등성을 갖는 method
  - GET 조회
  - PUT 대체: 데이터 없는 경우 생성. 요청 key 외에 대해서 초기화
  - DELETE 삭제
- 멱등성을 갖지 않는 method
  - POST 생성
  - PATCH 수정: 요청 값에 대해서만 수정 처리

서버의 상태(데이터베이스)를 변경시키지 않을 때 멱등성을 가진 요청이라 할 수 있다. 단순히 method 의 정의를 따르면 위의 분류가 맞지만, 결국 구현하기 나름이더라.
API가 하나 이상의 기능을 수행하고 그게 서버의 상태를 변경시킨다면, 멱등성을 갖는 method 일지라도 멱등성을 갖추지 않은 게 된다.

하나의 API는 하나의 기능에 충실, 또는 내부 상의를 통해 타 method 로 변경해 멱등성의 유/무를 유추할 수 있게 하는 게 맞을까?

또한, 멱등성과 안전성은 같지 않다.
멱등성은 여러 요청에도 같은 서버 상태를 나타내고 이게 자원의 변경된 상태일 수 있다. 안전성은 자원의 상태를 변경시키지 않는다. (ex. GET, OPTION, HEAD)